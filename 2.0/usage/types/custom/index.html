
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Data validation using Python type hints">
      
      
      
        <link rel="canonical" href="https://docs.pydantic.dev/latest/usage/types/custom/">
      
      
        <link rel="prev" href="../encoded/">
      
      
        <link rel="next" href="../extra_types/extra_types/">
      
      <link rel="icon" href="../../../favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.17">
    
    
      
        <title>Custom Data Types - Pydantic</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../extra/terminal.css">
    
      <link rel="stylesheet" href="../../../extra/tweaks.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="pink" data-md-color-accent="pink">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#composing-types-via-annotated" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
        <aside class="md-banner">
          <div class="md-banner__inner md-grid md-typeset">
            
              <button class="md-banner__button md-icon" aria-label="Don't show this again">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
              </button>
            
            
  <!-- the following line is displayed in the announcement bar -->
<!-- keep length under 164 characters (less HTML tags) to fit on 1280px desktop window -->
<a href="https://docs.pydantic.dev/2.0/blog/pydantic-v2-final/">Pydantic V2</a> is here ðŸš€! Upgrading an existing app? See the <a href="https://docs.pydantic.dev/2.0/migration/">Migration Guide</a> for tips on essential changes from Pydantic V1!

          </div>
          
            <script>var content,el=document.querySelector("[data-md-component=announce]");el&&(content=el.querySelector(".md-typeset"),__md_hash(content.innerHTML)===__md_get("__announce")&&(el.hidden=!0))</script>
          
        </aside>
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Pydantic" class="md-header__button md-logo" aria-label="Pydantic" data-md-component="logo">
      
  <img src="../../../logo-white.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Pydantic
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Custom Data Types
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="pink" data-md-color-accent="pink"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="pink" data-md-color-accent="pink"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/pydantic/pydantic" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    pydantic/pydantic
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        Get Started
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../models/" class="md-tabs__link md-tabs__link--active">
        Usage
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../errors/errors/" class="md-tabs__link">
        Error Messages
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../integrations/mypy/" class="md-tabs__link">
        Integrations
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../contributing/" class="md-tabs__link">
      Contribute
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../blog/pydantic-v2-final/" class="md-tabs__link">
        Blog
      </a>
    </li>
  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../../api/main/" class="md-tabs__link">
        API Documentation
      </a>
    </li>
  

  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Pydantic" class="md-nav__button md-logo" aria-label="Pydantic" data-md-component="logo">
      
  <img src="../../../logo-white.svg" alt="logo">

    </a>
    Pydantic
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/pydantic/pydantic" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    pydantic/pydantic
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
      
      
      
        <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
          Get Started
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Get Started
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Welcome to Pydantic
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../install/" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../migration/" class="md-nav__link">
        Migration Guide
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../version-compatibility/" class="md-nav__link">
        Version Compatibility
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../changelog/" class="md-nav__link">
        Changelog
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Usage
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Usage
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../models/" class="md-nav__link">
        Models
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          Field Types
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Field Types
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../types/" class="md-nav__link">
        Types Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../standard_types/" class="md-nav__link">
        Standard Library Types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../booleans/" class="md-nav__link">
        Booleans
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../bytesize/" class="md-nav__link">
        ByteSize
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../callables/" class="md-nav__link">
        Callables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../datetime/" class="md-nav__link">
        Datetimes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../dicts_mapping/" class="md-nav__link">
        Dicts and Mapping
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../encoded/" class="md-nav__link">
        Encoded Types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../enums/" class="md-nav__link">
        Enums and Choices
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../file_types/" class="md-nav__link">
        File Types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../json/" class="md-nav__link">
        JSON
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../list_types/" class="md-nav__link">
        Lists and Tuples
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../number_types/" class="md-nav__link">
        Number Types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../secrets/" class="md-nav__link">
        Secret Types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../sequence_iterable/" class="md-nav__link">
        Sequence, Iterable & Iterator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../set_types/" class="md-nav__link">
        Sets and frozenset
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../strict_types/" class="md-nav__link">
        Strict Types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../string_types/" class="md-nav__link">
        String Types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../typevars/" class="md-nav__link">
        Type and TypeVar
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../types_fields/" class="md-nav__link">
        Types with Fields
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../unions/" class="md-nav__link">
        Unions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../urls/" class="md-nav__link">
        URLs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../uuids/" class="md-nav__link">
        UUIDs
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../encoded/" class="md-nav__link">
        Encoded
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Custom Data Types
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Custom Data Types
      </a>
      
        

  

<nav class="md-nav md-nav--secondary" aria-label="Page contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Page contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#composing-types-via-annotated" class="md-nav__link">
    Composing types via Annotated
  </a>
  
    <nav class="md-nav" aria-label="Composing types via Annotated">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-validation-and-serialization" class="md-nav__link">
    Adding validation and serialization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generics" class="md-nav__link">
    Generics
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#named-type-aliases" class="md-nav__link">
    Named type aliases
  </a>
  
    <nav class="md-nav" aria-label="Named type aliases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#named-recursive-types" class="md-nav__link">
    Named recursive types
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handling-third-party-types" class="md-nav__link">
    Handling third-party types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-custom-classes-using-__get_pydantic_core_schema__" class="md-nav__link">
    Creating custom classes using __get_pydantic_core_schema__
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generic-classes-as-types" class="md-nav__link">
    Generic classes as types
  </a>
  
    <nav class="md-nav" aria-label="Generic classes as types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generic-containers" class="md-nav__link">
    Generic containers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_26" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2_26" id="__nav_2_2_26_label" tabindex="0">
          Extra Types
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_26_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2_26">
          <span class="md-nav__icon md-icon"></span>
          Extra Types
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../extra_types/extra_types/" class="md-nav__link">
        Extra Types Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../extra_types/color_types/" class="md-nav__link">
        Color Types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../extra_types/payment_cards/" class="md-nav__link">
        Payment Card Numbers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../extra_types/phone_numbers/" class="md-nav__link">
        Phone Numbers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../extra_types/routing_numbers/" class="md-nav__link">
        Routing Numbers
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../validators/" class="md-nav__link">
        Validators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../model_config/" class="md-nav__link">
        Model Config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../fields/" class="md-nav__link">
        Fields
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../json_schema/" class="md-nav__link">
        JSON Schema
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../serialization/" class="md-nav__link">
        Serialization
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../computed_fields/" class="md-nav__link">
        Computed Fields
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../dataclasses/" class="md-nav__link">
        Dataclasses
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../validation_decorator/" class="md-nav__link">
        Validation Decorator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../postponed_annotations/" class="md-nav__link">
        Postponed Annotations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../strict_mode/" class="md-nav__link">
        Strict Mode
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../conversion_table/" class="md-nav__link">
        Conversion Table
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../pydantic_settings/" class="md-nav__link">
        Settings Management
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Error Messages
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Error Messages
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../errors/errors/" class="md-nav__link">
        Error Handling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../validation_errors/" class="md-nav__link">
        Validation Errors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../errors/" class="md-nav__link">
        Usage Errors
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Integrations
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Integrations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../integrations/mypy/" class="md-nav__link">
        Mypy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../integrations/pycharm/" class="md-nav__link">
        PyCharm
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../integrations/hypothesis/" class="md-nav__link">
        Hypothesis
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../integrations/visual_studio_code/" class="md-nav__link">
        Visual Studio Code
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../integrations/datamodel_code_generator/" class="md-nav__link">
        datamodel-code-generator
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../integrations/devtools/" class="md-nav__link">
        devtools
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../integrations/rich/" class="md-nav__link">
        Rich
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../contributing/" class="md-nav__link">
        Contribute
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Blog
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Blog
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/pydantic-v2-final/" class="md-nav__link">
        Pydantic V2 Is Here!
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/pydantic-v2-alpha/" class="md-nav__link">
        Pydantic V2 Pre Release
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../blog/pydantic-v2/" class="md-nav__link">
        Pydantic V2 Plan
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          API Documentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          API Documentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1" >
      
      
      
        <label class="md-nav__link" for="__nav_7_1" id="__nav_7_1_label" tabindex="0">
          Pydantic
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_1">
          <span class="md-nav__icon md-icon"></span>
          Pydantic
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/main/" class="md-nav__link">
        pydantic
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/alias_generators/" class="md-nav__link">
        pydantic.alias_generators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/color/" class="md-nav__link">
        pydantic.color
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/config/" class="md-nav__link">
        pydantic.config
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/dataclasses/" class="md-nav__link">
        pydantic.dataclasses
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/errors/" class="md-nav__link">
        pydantic.errors
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/fields/" class="md-nav__link">
        pydantic.fields
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/functional_serializers/" class="md-nav__link">
        pydantic.functional_serializers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/functional_validators/" class="md-nav__link">
        pydantic.functional_validators
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/json_schema/" class="md-nav__link">
        pydantic.json_schema
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/mypy/" class="md-nav__link">
        pydantic.mypy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/networks/" class="md-nav__link">
        pydantic.networks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/root_model/" class="md-nav__link">
        pydantic.root_model
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/type_adapter/" class="md-nav__link">
        pydantic.type_adapter
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/types/" class="md-nav__link">
        pydantic.types
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/validate_call/" class="md-nav__link">
        pydantic.validate_call
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/version/" class="md-nav__link">
        pydantic.version
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
      
      
      
        <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
          Pydantic Core
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_2">
          <span class="md-nav__icon md-icon"></span>
          Pydantic Core
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/pydantic_core_init/" class="md-nav__link">
        pydantic_core
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/pydantic_core_schema/" class="md-nav__link">
        pydantic_core.core_schema
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_3" >
      
      
      
        <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
          Pydantic Settings
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_3">
          <span class="md-nav__icon md-icon"></span>
          Pydantic Settings
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/pydantic_settings/" class="md-nav__link">
        pydantic_settings
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_4" >
      
      
      
        <label class="md-nav__link" for="__nav_7_4" id="__nav_7_4_label" tabindex="0">
          Pydantic Extra Types
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_4">
          <span class="md-nav__icon md-icon"></span>
          Pydantic Extra Types
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/pydantic_extra_types_color/" class="md-nav__link">
        pydantic_extra_types.color
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/pydantic_extra_types_country/" class="md-nav__link">
        pydantic_extra_types.country
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/pydantic_extra_types_payment/" class="md-nav__link">
        pydantic_extra_types.payment
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/pydantic_extra_types_phone_numbers/" class="md-nav__link">
        pydantic_extra_types.phone_numbers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../api/pydantic_extra_types_routing_number/" class="md-nav__link">
        pydantic_extra_types.routing_number
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="Page contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Page contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#composing-types-via-annotated" class="md-nav__link">
    Composing types via Annotated
  </a>
  
    <nav class="md-nav" aria-label="Composing types via Annotated">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-validation-and-serialization" class="md-nav__link">
    Adding validation and serialization
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#generics" class="md-nav__link">
    Generics
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#named-type-aliases" class="md-nav__link">
    Named type aliases
  </a>
  
    <nav class="md-nav" aria-label="Named type aliases">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#named-recursive-types" class="md-nav__link">
    Named recursive types
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handling-third-party-types" class="md-nav__link">
    Handling third-party types
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#creating-custom-classes-using-__get_pydantic_core_schema__" class="md-nav__link">
    Creating custom classes using __get_pydantic_core_schema__
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#generic-classes-as-types" class="md-nav__link">
    Generic classes as types
  </a>
  
    <nav class="md-nav" aria-label="Generic classes as types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#generic-containers" class="md-nav__link">
    Generic containers
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
  
                  

  
  


  <h1>Custom Data Types</h1>

<p>You can also define your own custom data types. There are several ways to achieve it.</p>
<h2 id="composing-types-via-annotated">Composing types via <code>Annotated</code><a class="headerlink" href="#composing-types-via-annotated" title="Permanent link">&para;</a></h2>
<p><a href="https://peps.python.org/pep-0593/">PEP 593</a> introduced <code>Annotated</code> as a way to attach runtime metadata to types without changing how type checkers interpret them.
Pydantic takes advantage of this to allow you to create types that are identical to the original type as far as type checkers are concerned, but add validation, serialize differently, etc.</p>
<p>For example, to create a type representing a positive int:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:2"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><input id="__tabbed_1_2" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Python 3.7 and above</label><label for="__tabbed_1_2">Python 3.9 and above</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1"># or `from typing import Annotated` for Python 3.9+</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Annotated</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">Field</span><span class="p">,</span> <span class="n">TypeAdapter</span><span class="p">,</span> <span class="n">ValidationError</span>

<span class="n">PositiveInt</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>

<span class="n">ta</span> <span class="o">=</span> <span class="n">TypeAdapter</span><span class="p">(</span><span class="n">PositiveInt</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ta</span><span class="o">.</span><span class="n">validate_python</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="c1">#&gt; 1</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">ta</span><span class="o">.</span><span class="n">validate_python</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1 validation error for constrained-int</span>
<span class="sd">      Input should be greater than 0 [type=greater_than, input_value=-1, input_type=int]</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="c1"># or `from typing import Annotated` for Python 3.9+</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Annotated</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">Field</span><span class="p">,</span> <span class="n">TypeAdapter</span><span class="p">,</span> <span class="n">ValidationError</span>

<span class="n">PositiveInt</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Field</span><span class="p">(</span><span class="n">gt</span><span class="o">=</span><span class="mi">0</span><span class="p">)]</span>

<span class="n">ta</span> <span class="o">=</span> <span class="n">TypeAdapter</span><span class="p">(</span><span class="n">PositiveInt</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ta</span><span class="o">.</span><span class="n">validate_python</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="c1">#&gt; 1</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">ta</span><span class="o">.</span><span class="n">validate_python</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1 validation error for constrained-int</span>
<span class="sd">      Input should be greater than 0 [type=greater_than, input_value=-1, input_type=int]</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
</div>
</div>
</div>
<p>Note that you can also use constraints from <a href="https://github.com/annotated-types/annotated-types">annotated-types</a>
to make this Pydantic-agnostic:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="2:2"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><input id="__tabbed_2_2" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">Python 3.7 and above</label><label for="__tabbed_2_2">Python 3.9 and above</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">annotated_types</span> <span class="kn">import</span> <span class="n">Gt</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Annotated</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">TypeAdapter</span><span class="p">,</span> <span class="n">ValidationError</span>

<span class="n">PositiveInt</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>

<span class="n">ta</span> <span class="o">=</span> <span class="n">TypeAdapter</span><span class="p">(</span><span class="n">PositiveInt</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ta</span><span class="o">.</span><span class="n">validate_python</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="c1">#&gt; 1</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">ta</span><span class="o">.</span><span class="n">validate_python</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1 validation error for constrained-int</span>
<span class="sd">      Input should be greater than 0 [type=greater_than, input_value=-1, input_type=int]</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">annotated_types</span> <span class="kn">import</span> <span class="n">Gt</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Annotated</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">TypeAdapter</span><span class="p">,</span> <span class="n">ValidationError</span>

<span class="n">PositiveInt</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)]</span>

<span class="n">ta</span> <span class="o">=</span> <span class="n">TypeAdapter</span><span class="p">(</span><span class="n">PositiveInt</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">ta</span><span class="o">.</span><span class="n">validate_python</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="c1">#&gt; 1</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">ta</span><span class="o">.</span><span class="n">validate_python</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1 validation error for constrained-int</span>
<span class="sd">      Input should be greater than 0 [type=greater_than, input_value=-1, input_type=int]</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="adding-validation-and-serialization">Adding validation and serialization<a class="headerlink" href="#adding-validation-and-serialization" title="Permanent link">&para;</a></h3>
<p>You can add or override validation, serialization, and JSON schemas to an arbitrary type using the markers that
Pydantic exports:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:2"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><input id="__tabbed_3_2" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">Python 3.7 and above</label><label for="__tabbed_3_2">Python 3.9 and above</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Annotated</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">AfterValidator</span><span class="p">,</span>
    <span class="n">PlainSerializer</span><span class="p">,</span>
    <span class="n">TypeAdapter</span><span class="p">,</span>
    <span class="n">WithJsonSchema</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span> <span class="nc">MyType</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>


<span class="n">TruncatedFloat</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span>
    <span class="nb">float</span><span class="p">,</span>
    <span class="n">AfterValidator</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
    <span class="n">PlainSerializer</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.1e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
    <span class="n">WithJsonSchema</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">},</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;serialization&#39;</span><span class="p">),</span>
<span class="p">]</span>


<span class="n">ta</span> <span class="o">=</span> <span class="n">TypeAdapter</span><span class="p">(</span><span class="n">TruncatedFloat</span><span class="p">)</span>

<span class="nb">input</span> <span class="o">=</span> <span class="mf">1.02345</span>
<span class="k">assert</span> <span class="nb">input</span> <span class="o">!=</span> <span class="mf">1.0</span>

<span class="k">assert</span> <span class="n">ta</span><span class="o">.</span><span class="n">validate_python</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span> <span class="o">==</span> <span class="mf">1.0</span>

<span class="k">assert</span> <span class="n">ta</span><span class="o">.</span><span class="n">dump_json</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;&quot;1.0e+00&quot;&#39;</span>

<span class="k">assert</span> <span class="n">ta</span><span class="o">.</span><span class="n">json_schema</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;validation&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;number&#39;</span><span class="p">}</span>
<span class="k">assert</span> <span class="n">ta</span><span class="o">.</span><span class="n">json_schema</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;serialization&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Annotated</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">AfterValidator</span><span class="p">,</span>
    <span class="n">PlainSerializer</span><span class="p">,</span>
    <span class="n">TypeAdapter</span><span class="p">,</span>
    <span class="n">WithJsonSchema</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">class</span> <span class="nc">MyType</span><span class="p">:</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>


<span class="n">TruncatedFloat</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span>
    <span class="nb">float</span><span class="p">,</span>
    <span class="n">AfterValidator</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
    <span class="n">PlainSerializer</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">x</span><span class="si">:</span><span class="s1">.1e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="nb">str</span><span class="p">),</span>
    <span class="n">WithJsonSchema</span><span class="p">({</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">},</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;serialization&#39;</span><span class="p">),</span>
<span class="p">]</span>


<span class="n">ta</span> <span class="o">=</span> <span class="n">TypeAdapter</span><span class="p">(</span><span class="n">TruncatedFloat</span><span class="p">)</span>

<span class="nb">input</span> <span class="o">=</span> <span class="mf">1.02345</span>
<span class="k">assert</span> <span class="nb">input</span> <span class="o">!=</span> <span class="mf">1.0</span>

<span class="k">assert</span> <span class="n">ta</span><span class="o">.</span><span class="n">validate_python</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span> <span class="o">==</span> <span class="mf">1.0</span>

<span class="k">assert</span> <span class="n">ta</span><span class="o">.</span><span class="n">dump_json</span><span class="p">(</span><span class="nb">input</span><span class="p">)</span> <span class="o">==</span> <span class="sa">b</span><span class="s1">&#39;&quot;1.0e+00&quot;&#39;</span>

<span class="k">assert</span> <span class="n">ta</span><span class="o">.</span><span class="n">json_schema</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;validation&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;number&#39;</span><span class="p">}</span>
<span class="k">assert</span> <span class="n">ta</span><span class="o">.</span><span class="n">json_schema</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;serialization&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;string&#39;</span><span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="generics">Generics<a class="headerlink" href="#generics" title="Permanent link">&para;</a></h3>
<p>You can use type variables within <code>Annotated</code> to make re-usable modifications to types:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="4:2"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><input id="__tabbed_4_2" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">Python 3.7 and above</label><label for="__tabbed_4_2">Python 3.9 and above</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="kn">from</span> <span class="nn">annotated_types</span> <span class="kn">import</span> <span class="n">Gt</span><span class="p">,</span> <span class="n">Len</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Annotated</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">ValidationError</span>
<span class="kn">from</span> <span class="nn">pydantic.type_adapter</span> <span class="kn">import</span> <span class="n">TypeAdapter</span>

<span class="n">SequenceType</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;SequenceType&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span>


<span class="n">ShortSequence</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">SequenceType</span><span class="p">,</span> <span class="n">Len</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)]</span>


<span class="n">ta</span> <span class="o">=</span> <span class="n">TypeAdapter</span><span class="p">(</span><span class="n">ShortSequence</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]])</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">validate_python</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="k">assert</span> <span class="n">v</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">ta</span><span class="o">.</span><span class="n">validate_python</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1 validation error for list[int]</span>
<span class="sd">      List should have at most 10 items after validation, not 11 [type=too_long, input_value=[1, 1, 1, 1, 1, 1, 1, 1, ... 1, 1, 1, 1, 1, 1, 1, 1], input_type=list]</span>
<span class="sd">    &quot;&quot;&quot;</span>


<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>  <span class="c1"># or a bound=SupportGt</span>

<span class="n">PositiveList</span> <span class="o">=</span> <span class="n">List</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)]]</span>

<span class="n">ta</span> <span class="o">=</span> <span class="n">TypeAdapter</span><span class="p">(</span><span class="n">PositiveList</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">validate_python</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">float</span>


<span class="k">try</span><span class="p">:</span>
    <span class="n">ta</span><span class="o">.</span><span class="n">validate_python</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1 validation error for list[constrained-float]</span>
<span class="sd">    0</span>
<span class="sd">      Input should be greater than 0 [type=greater_than, input_value=-1, input_type=int]</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">TypeVar</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Sequence</span>

<span class="kn">from</span> <span class="nn">annotated_types</span> <span class="kn">import</span> <span class="n">Gt</span><span class="p">,</span> <span class="n">Len</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Annotated</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">ValidationError</span>
<span class="kn">from</span> <span class="nn">pydantic.type_adapter</span> <span class="kn">import</span> <span class="n">TypeAdapter</span>

<span class="n">SequenceType</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;SequenceType&#39;</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Any</span><span class="p">])</span>


<span class="n">ShortSequence</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span><span class="n">SequenceType</span><span class="p">,</span> <span class="n">Len</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">10</span><span class="p">)]</span>


<span class="n">ta</span> <span class="o">=</span> <span class="n">TypeAdapter</span><span class="p">(</span><span class="n">ShortSequence</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]])</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">validate_python</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="k">assert</span> <span class="n">v</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">ta</span><span class="o">.</span><span class="n">validate_python</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1 validation error for list[int]</span>
<span class="sd">      List should have at most 10 items after validation, not 11 [type=too_long, input_value=[1, 1, 1, 1, 1, 1, 1, 1, ... 1, 1, 1, 1, 1, 1, 1, 1], input_type=list]</span>
<span class="sd">    &quot;&quot;&quot;</span>


<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>  <span class="c1"># or a bound=SupportGt</span>

<span class="n">PositiveList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)]]</span>

<span class="n">ta</span> <span class="o">=</span> <span class="n">TypeAdapter</span><span class="p">(</span><span class="n">PositiveList</span><span class="p">[</span><span class="nb">float</span><span class="p">])</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">validate_python</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
<span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">float</span>


<span class="k">try</span><span class="p">:</span>
    <span class="n">ta</span><span class="o">.</span><span class="n">validate_python</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1 validation error for list[constrained-float]</span>
<span class="sd">    0</span>
<span class="sd">      Input should be greater than 0 [type=greater_than, input_value=-1, input_type=int]</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
</div>
</div>
</div>
<h2 id="named-type-aliases">Named type aliases<a class="headerlink" href="#named-type-aliases" title="Permanent link">&para;</a></h2>
<p>The above examples make use of implicit type aliases.
This means that they will not be able to have a <code>title</code> in JSON schemas and their schema will be copied between fields.
You can use <a href="https://peps.python.org/pep-0695/">PEP 695</a>'s <code>TypeAliasType</code> via its <a href="https://github.com/python/typing_extensions">typing-extensions</a> backport to make named aliases, allowing you to define a new type without creating subclasses.
This new type can be as simple as a name or have complex validation logic attached to it:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="5:2"><input checked="checked" id="__tabbed_5_1" name="__tabbed_5" type="radio" /><input id="__tabbed_5_2" name="__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="__tabbed_5_1">Python 3.7 and above</label><label for="__tabbed_5_2">Python 3.9 and above</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="kn">from</span> <span class="nn">annotated_types</span> <span class="kn">import</span> <span class="n">Gt</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Annotated</span><span class="p">,</span> <span class="n">TypeAliasType</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>  <span class="c1"># or a `bound=SupportGt`</span>

<span class="n">ImplicitAliasPositiveIntList</span> <span class="o">=</span> <span class="n">List</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)]]</span>


<span class="k">class</span> <span class="nc">Model1</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">ImplicitAliasPositiveIntList</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">ImplicitAliasPositiveIntList</span>


<span class="nb">print</span><span class="p">(</span><span class="n">Model1</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">())</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{</span>
<span class="sd">    &#39;properties&#39;: {</span>
<span class="sd">        &#39;x&#39;: {</span>
<span class="sd">            &#39;items&#39;: {&#39;exclusiveMinimum&#39;: 0, &#39;type&#39;: &#39;integer&#39;},</span>
<span class="sd">            &#39;title&#39;: &#39;X&#39;,</span>
<span class="sd">            &#39;type&#39;: &#39;array&#39;,</span>
<span class="sd">        },</span>
<span class="sd">        &#39;y&#39;: {</span>
<span class="sd">            &#39;items&#39;: {&#39;exclusiveMinimum&#39;: 0, &#39;type&#39;: &#39;integer&#39;},</span>
<span class="sd">            &#39;title&#39;: &#39;Y&#39;,</span>
<span class="sd">            &#39;type&#39;: &#39;array&#39;,</span>
<span class="sd">        },</span>
<span class="sd">    },</span>
<span class="sd">    &#39;required&#39;: [&#39;x&#39;, &#39;y&#39;],</span>
<span class="sd">    &#39;title&#39;: &#39;Model1&#39;,</span>
<span class="sd">    &#39;type&#39;: &#39;object&#39;,</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">PositiveIntList</span> <span class="o">=</span> <span class="n">TypeAliasType</span><span class="p">(</span><span class="s1">&#39;PositiveIntList&#39;</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)]])</span>


<span class="k">class</span> <span class="nc">Model2</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">PositiveIntList</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">PositiveIntList</span>


<span class="nb">print</span><span class="p">(</span><span class="n">Model2</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">())</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{</span>
<span class="sd">    &#39;$defs&#39;: {</span>
<span class="sd">        &#39;PositiveIntList&#39;: {</span>
<span class="sd">            &#39;items&#39;: {&#39;exclusiveMinimum&#39;: 0, &#39;type&#39;: &#39;integer&#39;},</span>
<span class="sd">            &#39;type&#39;: &#39;array&#39;,</span>
<span class="sd">        }</span>
<span class="sd">    },</span>
<span class="sd">    &#39;properties&#39;: {</span>
<span class="sd">        &#39;x&#39;: {&#39;$ref&#39;: &#39;#/$defs/PositiveIntList&#39;},</span>
<span class="sd">        &#39;y&#39;: {&#39;$ref&#39;: &#39;#/$defs/PositiveIntList&#39;},</span>
<span class="sd">    },</span>
<span class="sd">    &#39;required&#39;: [&#39;x&#39;, &#39;y&#39;],</span>
<span class="sd">    &#39;title&#39;: &#39;Model2&#39;,</span>
<span class="sd">    &#39;type&#39;: &#39;object&#39;,</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TypeVar</span>

<span class="kn">from</span> <span class="nn">annotated_types</span> <span class="kn">import</span> <span class="n">Gt</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">TypeAliasType</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Annotated</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>  <span class="c1"># or a `bound=SupportGt`</span>

<span class="n">ImplicitAliasPositiveIntList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)]]</span>


<span class="k">class</span> <span class="nc">Model1</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">ImplicitAliasPositiveIntList</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">ImplicitAliasPositiveIntList</span>


<span class="nb">print</span><span class="p">(</span><span class="n">Model1</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">())</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{</span>
<span class="sd">    &#39;properties&#39;: {</span>
<span class="sd">        &#39;x&#39;: {</span>
<span class="sd">            &#39;items&#39;: {&#39;exclusiveMinimum&#39;: 0, &#39;type&#39;: &#39;integer&#39;},</span>
<span class="sd">            &#39;title&#39;: &#39;X&#39;,</span>
<span class="sd">            &#39;type&#39;: &#39;array&#39;,</span>
<span class="sd">        },</span>
<span class="sd">        &#39;y&#39;: {</span>
<span class="sd">            &#39;items&#39;: {&#39;exclusiveMinimum&#39;: 0, &#39;type&#39;: &#39;integer&#39;},</span>
<span class="sd">            &#39;title&#39;: &#39;Y&#39;,</span>
<span class="sd">            &#39;type&#39;: &#39;array&#39;,</span>
<span class="sd">        },</span>
<span class="sd">    },</span>
<span class="sd">    &#39;required&#39;: [&#39;x&#39;, &#39;y&#39;],</span>
<span class="sd">    &#39;title&#39;: &#39;Model1&#39;,</span>
<span class="sd">    &#39;type&#39;: &#39;object&#39;,</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">PositiveIntList</span> <span class="o">=</span> <span class="n">TypeAliasType</span><span class="p">(</span><span class="s1">&#39;PositiveIntList&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)]])</span>


<span class="k">class</span> <span class="nc">Model2</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">PositiveIntList</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">PositiveIntList</span>


<span class="nb">print</span><span class="p">(</span><span class="n">Model2</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">())</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{</span>
<span class="sd">    &#39;$defs&#39;: {</span>
<span class="sd">        &#39;PositiveIntList&#39;: {</span>
<span class="sd">            &#39;items&#39;: {&#39;exclusiveMinimum&#39;: 0, &#39;type&#39;: &#39;integer&#39;},</span>
<span class="sd">            &#39;type&#39;: &#39;array&#39;,</span>
<span class="sd">        }</span>
<span class="sd">    },</span>
<span class="sd">    &#39;properties&#39;: {</span>
<span class="sd">        &#39;x&#39;: {&#39;$ref&#39;: &#39;#/$defs/PositiveIntList&#39;},</span>
<span class="sd">        &#39;y&#39;: {&#39;$ref&#39;: &#39;#/$defs/PositiveIntList&#39;},</span>
<span class="sd">    },</span>
<span class="sd">    &#39;required&#39;: [&#39;x&#39;, &#39;y&#39;],</span>
<span class="sd">    &#39;title&#39;: &#39;Model2&#39;,</span>
<span class="sd">    &#39;type&#39;: &#39;object&#39;,</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>
</code></pre></div>
</div>
</div>
</div>
<p>These named type aliases can also be generic:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="6:2"><input checked="checked" id="__tabbed_6_1" name="__tabbed_6" type="radio" /><input id="__tabbed_6_2" name="__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="__tabbed_6_1">Python 3.7 and above</label><label for="__tabbed_6_2">Python 3.9 and above</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Generic</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="kn">from</span> <span class="nn">annotated_types</span> <span class="kn">import</span> <span class="n">Gt</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Annotated</span><span class="p">,</span> <span class="n">TypeAliasType</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">ValidationError</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>  <span class="c1"># or a bound=SupportGt</span>

<span class="n">PositiveList</span> <span class="o">=</span> <span class="n">TypeAliasType</span><span class="p">(</span>
    <span class="s1">&#39;PositiveList&#39;</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)]],</span> <span class="n">type_params</span><span class="o">=</span><span class="p">(</span><span class="n">T</span><span class="p">,)</span>
<span class="p">)</span>


<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">,</span> <span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">PositiveList</span><span class="p">[</span><span class="n">T</span><span class="p">]</span>


<span class="k">assert</span> <span class="n">Model</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">.</span><span class="n">model_validate_json</span><span class="p">(</span><span class="s1">&#39;{&quot;x&quot;: [&quot;1&quot;]}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">Model</span><span class="p">[</span><span class="nb">int</span><span class="p">](</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1 validation error for Model[int]</span>
<span class="sd">    x.0</span>
<span class="sd">      Input should be greater than 0 [type=greater_than, input_value=-1, input_type=int]</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Generic</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="kn">from</span> <span class="nn">annotated_types</span> <span class="kn">import</span> <span class="n">Gt</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">TypeAliasType</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Annotated</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">ValidationError</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>  <span class="c1"># or a bound=SupportGt</span>

<span class="n">PositiveList</span> <span class="o">=</span> <span class="n">TypeAliasType</span><span class="p">(</span>
    <span class="s1">&#39;PositiveList&#39;</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Annotated</span><span class="p">[</span><span class="n">T</span><span class="p">,</span> <span class="n">Gt</span><span class="p">(</span><span class="mi">0</span><span class="p">)]],</span> <span class="n">type_params</span><span class="o">=</span><span class="p">(</span><span class="n">T</span><span class="p">,)</span>
<span class="p">)</span>


<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">,</span> <span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">PositiveList</span><span class="p">[</span><span class="n">T</span><span class="p">]</span>


<span class="k">assert</span> <span class="n">Model</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">.</span><span class="n">model_validate_json</span><span class="p">(</span><span class="s1">&#39;{&quot;x&quot;: [&quot;1&quot;]}&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">Model</span><span class="p">[</span><span class="nb">int</span><span class="p">](</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1 validation error for Model[int]</span>
<span class="sd">    x.0</span>
<span class="sd">      Input should be greater than 0 [type=greater_than, input_value=-1, input_type=int]</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="named-recursive-types">Named recursive types<a class="headerlink" href="#named-recursive-types" title="Permanent link">&para;</a></h3>
<p>You can also use <code>TypeAliasType</code> to create recursive types:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="7:2"><input checked="checked" id="__tabbed_7_1" name="__tabbed_7" type="radio" /><input id="__tabbed_7_2" name="__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="__tabbed_7_1">Python 3.7 and above</label><label for="__tabbed_7_2">Python 3.9 and above</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">pydantic_core</span> <span class="kn">import</span> <span class="n">PydanticCustomError</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Annotated</span><span class="p">,</span> <span class="n">TypeAliasType</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">TypeAdapter</span><span class="p">,</span>
    <span class="n">ValidationError</span><span class="p">,</span>
    <span class="n">ValidationInfo</span><span class="p">,</span>
    <span class="n">ValidatorFunctionWrapHandler</span><span class="p">,</span>
    <span class="n">WrapValidator</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">json_custom_error_validator</span><span class="p">(</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">handler</span><span class="p">:</span> <span class="n">ValidatorFunctionWrapHandler</span><span class="p">,</span> <span class="n">_info</span><span class="p">:</span> <span class="n">ValidationInfo</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simplify the error message to avoid a gross error stemming</span>
<span class="sd">    from exhaustive checking of all union options.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">handler</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ValidationError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">PydanticCustomError</span><span class="p">(</span>
            <span class="s1">&#39;invalid_json&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Input is not valid json&#39;</span><span class="p">,</span>
        <span class="p">)</span>


<span class="n">Json</span> <span class="o">=</span> <span class="n">TypeAliasType</span><span class="p">(</span>
    <span class="s1">&#39;Json&#39;</span><span class="p">,</span>
    <span class="n">Annotated</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s1">&#39;Json&#39;</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="s1">&#39;Json&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="n">WrapValidator</span><span class="p">(</span><span class="n">json_custom_error_validator</span><span class="p">),</span>
    <span class="p">],</span>
<span class="p">)</span>


<span class="n">ta</span> <span class="o">=</span> <span class="n">TypeAdapter</span><span class="p">(</span><span class="n">Json</span><span class="p">)</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">validate_python</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}})</span>
<span class="k">assert</span> <span class="n">v</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}}</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">ta</span><span class="o">.</span><span class="n">validate_python</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="nb">object</span><span class="p">()})</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1 validation error for function-wrap[json_custom_error_validator()]</span>
<span class="sd">      Input is not valid json [type=invalid_json, input_value={&#39;x&#39;: &lt;object object at 0x0123456789ab&gt;}, input_type=dict]</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">from</span> <span class="nn">pydantic_core</span> <span class="kn">import</span> <span class="n">PydanticCustomError</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">TypeAliasType</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Annotated</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">TypeAdapter</span><span class="p">,</span>
    <span class="n">ValidationError</span><span class="p">,</span>
    <span class="n">ValidationInfo</span><span class="p">,</span>
    <span class="n">ValidatorFunctionWrapHandler</span><span class="p">,</span>
    <span class="n">WrapValidator</span><span class="p">,</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">json_custom_error_validator</span><span class="p">(</span>
    <span class="n">value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">handler</span><span class="p">:</span> <span class="n">ValidatorFunctionWrapHandler</span><span class="p">,</span> <span class="n">_info</span><span class="p">:</span> <span class="n">ValidationInfo</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Simplify the error message to avoid a gross error stemming</span>
<span class="sd">    from exhaustive checking of all union options.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">handler</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">ValidationError</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">PydanticCustomError</span><span class="p">(</span>
            <span class="s1">&#39;invalid_json&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Input is not valid json&#39;</span><span class="p">,</span>
        <span class="p">)</span>


<span class="n">Json</span> <span class="o">=</span> <span class="n">TypeAliasType</span><span class="p">(</span>
    <span class="s1">&#39;Json&#39;</span><span class="p">,</span>
    <span class="n">Annotated</span><span class="p">[</span>
        <span class="n">Union</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="s1">&#39;Json&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="s1">&#39;Json&#39;</span><span class="p">],</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="n">WrapValidator</span><span class="p">(</span><span class="n">json_custom_error_validator</span><span class="p">),</span>
    <span class="p">],</span>
<span class="p">)</span>


<span class="n">ta</span> <span class="o">=</span> <span class="n">TypeAdapter</span><span class="p">(</span><span class="n">Json</span><span class="p">)</span>

<span class="n">v</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">validate_python</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}})</span>
<span class="k">assert</span> <span class="n">v</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;z&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}}</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">ta</span><span class="o">.</span><span class="n">validate_python</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="nb">object</span><span class="p">()})</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    1 validation error for function-wrap[json_custom_error_validator()]</span>
<span class="sd">      Input is not valid json [type=invalid_json, input_value={&#39;x&#39;: &lt;object object at 0x0123456789ab&gt;}, input_type=dict]</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
</div>
</div>
</div>
<h2 id="handling-third-party-types">Handling third-party types<a class="headerlink" href="#handling-third-party-types" title="Permanent link">&para;</a></h2>
<p>One particularly powerful thing about <code>Annotated</code> is that it lets you modify validation or serialization for third-party
types without creating subclasses or otherwise messing with the types themselves:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="8:3"><input checked="checked" id="__tabbed_8_1" name="__tabbed_8" type="radio" /><input id="__tabbed_8_2" name="__tabbed_8" type="radio" /><input id="__tabbed_8_3" name="__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="__tabbed_8_1">Python 3.7 and above</label><label for="__tabbed_8_2">Python 3.9 and above</label><label for="__tabbed_8_3">Python 3.10 and above</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">Callable</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">pydantic_core</span> <span class="kn">import</span> <span class="n">core_schema</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Annotated</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">BaseModel</span><span class="p">,</span>
    <span class="n">GetJsonSchemaHandler</span><span class="p">,</span>
    <span class="n">ValidationError</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pydantic.json_schema</span> <span class="kn">import</span> <span class="n">JsonSchemaValue</span>


<span class="k">class</span> <span class="nc">ThirdPartyType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is meant to represent a type from a third-party library that wasn&#39;t designed with Pydantic</span>
<span class="sd">    integration in mind, and so doesn&#39;t have a `pydantic_core.CoreSchema` or anything.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>


<span class="k">class</span> <span class="nc">_ThirdPartyTypePydanticAnnotation</span><span class="p">:</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__get_pydantic_core_schema__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">_source_type</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">_handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        We return a pydantic_core.CoreSchema that behaves in the following ways:</span>

<span class="sd">        * ints will be parsed as `ThirdPartyType` instances with the int as the x attribute</span>
<span class="sd">        * `ThirdPartyType` instances will be parsed as `ThirdPartyType` instances without any changes</span>
<span class="sd">        * Nothing else will pass validation</span>
<span class="sd">        * Serialization will always return just an int</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">validate_from_int</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ThirdPartyType</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">ThirdPartyType</span><span class="p">()</span>
            <span class="n">result</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="n">from_int_schema</span> <span class="o">=</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">chain_schema</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">core_schema</span><span class="o">.</span><span class="n">int_schema</span><span class="p">(),</span>
                <span class="n">core_schema</span><span class="o">.</span><span class="n">no_info_plain_validator_function</span><span class="p">(</span><span class="n">validate_from_int</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">json_or_python_schema</span><span class="p">(</span>
            <span class="n">json_schema</span><span class="o">=</span><span class="n">from_int_schema</span><span class="p">,</span>
            <span class="n">python_schema</span><span class="o">=</span><span class="n">core_schema</span><span class="o">.</span><span class="n">union_schema</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="c1"># check if it&#39;s an instance first before doing any further work</span>
                    <span class="n">core_schema</span><span class="o">.</span><span class="n">is_instance_schema</span><span class="p">(</span><span class="n">ThirdPartyType</span><span class="p">),</span>
                    <span class="n">from_int_schema</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">),</span>
            <span class="n">serialization</span><span class="o">=</span><span class="n">core_schema</span><span class="o">.</span><span class="n">plain_serializer_function_ser_schema</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">instance</span><span class="p">:</span> <span class="n">instance</span><span class="o">.</span><span class="n">x</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__get_pydantic_json_schema__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">_core_schema</span><span class="p">:</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">,</span> <span class="n">handler</span><span class="p">:</span> <span class="n">GetJsonSchemaHandler</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JsonSchemaValue</span><span class="p">:</span>
        <span class="c1"># Use the same schema that would be used for `int`</span>
        <span class="k">return</span> <span class="n">handler</span><span class="p">(</span><span class="n">core_schema</span><span class="o">.</span><span class="n">int_schema</span><span class="p">())</span>


<span class="c1"># We now create an `Annotated` wrapper that we&#39;ll use as the annotation for fields on `BaseModel`s, etc.</span>
<span class="n">PydanticThirdPartyType</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span>
    <span class="n">ThirdPartyType</span><span class="p">,</span> <span class="n">_ThirdPartyTypePydanticAnnotation</span>
<span class="p">]</span>


<span class="c1"># Create a model class that uses this annotation as a field</span>
<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">third_party_type</span><span class="p">:</span> <span class="n">PydanticThirdPartyType</span>


<span class="c1"># Demonstrate that this field is handled correctly, that ints are parsed into `ThirdPartyType`, and that</span>
<span class="c1"># these instances are also &quot;dumped&quot; directly into ints as expected.</span>
<span class="n">m_int</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">third_party_type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m_int</span><span class="o">.</span><span class="n">third_party_type</span><span class="p">,</span> <span class="n">ThirdPartyType</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">m_int</span><span class="o">.</span><span class="n">third_party_type</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="mi">1</span>
<span class="k">assert</span> <span class="n">m_int</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;third_party_type&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

<span class="c1"># Do the same thing where an instance of ThirdPartyType is passed in</span>
<span class="n">instance</span> <span class="o">=</span> <span class="n">ThirdPartyType</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">instance</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="mi">0</span>
<span class="n">instance</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">m_instance</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">third_party_type</span><span class="o">=</span><span class="n">instance</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m_instance</span><span class="o">.</span><span class="n">third_party_type</span><span class="p">,</span> <span class="n">ThirdPartyType</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">m_instance</span><span class="o">.</span><span class="n">third_party_type</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="mi">10</span>
<span class="k">assert</span> <span class="n">m_instance</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;third_party_type&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>

<span class="c1"># Demonstrate that validation errors are raised as expected for invalid inputs</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">Model</span><span class="p">(</span><span class="n">third_party_type</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    2 validation errors for Model</span>
<span class="sd">    third_party_type.is-instance[ThirdPartyType]</span>
<span class="sd">      Input should be an instance of ThirdPartyType [type=is_instance_of, input_value=&#39;a&#39;, input_type=str]</span>
<span class="sd">    third_party_type.chain[int,function-plain[validate_from_int()]]</span>
<span class="sd">      Input should be a valid integer, unable to parse string as an integer [type=int_parsing, input_value=&#39;a&#39;, input_type=str]</span>
<span class="sd">    &quot;&quot;&quot;</span>


<span class="k">assert</span> <span class="n">Model</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;third_party_type&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Third Party Type&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;integer&#39;</span><span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;third_party_type&#39;</span><span class="p">],</span>
    <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Model&#39;</span><span class="p">,</span>
    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Any</span><span class="p">,</span>
    <span class="n">Callable</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">from</span> <span class="nn">pydantic_core</span> <span class="kn">import</span> <span class="n">core_schema</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Annotated</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">BaseModel</span><span class="p">,</span>
    <span class="n">GetJsonSchemaHandler</span><span class="p">,</span>
    <span class="n">ValidationError</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pydantic.json_schema</span> <span class="kn">import</span> <span class="n">JsonSchemaValue</span>


<span class="k">class</span> <span class="nc">ThirdPartyType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is meant to represent a type from a third-party library that wasn&#39;t designed with Pydantic</span>
<span class="sd">    integration in mind, and so doesn&#39;t have a `pydantic_core.CoreSchema` or anything.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>


<span class="k">class</span> <span class="nc">_ThirdPartyTypePydanticAnnotation</span><span class="p">:</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__get_pydantic_core_schema__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">_source_type</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">_handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        We return a pydantic_core.CoreSchema that behaves in the following ways:</span>

<span class="sd">        * ints will be parsed as `ThirdPartyType` instances with the int as the x attribute</span>
<span class="sd">        * `ThirdPartyType` instances will be parsed as `ThirdPartyType` instances without any changes</span>
<span class="sd">        * Nothing else will pass validation</span>
<span class="sd">        * Serialization will always return just an int</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">validate_from_int</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ThirdPartyType</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">ThirdPartyType</span><span class="p">()</span>
            <span class="n">result</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="n">from_int_schema</span> <span class="o">=</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">chain_schema</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">core_schema</span><span class="o">.</span><span class="n">int_schema</span><span class="p">(),</span>
                <span class="n">core_schema</span><span class="o">.</span><span class="n">no_info_plain_validator_function</span><span class="p">(</span><span class="n">validate_from_int</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">json_or_python_schema</span><span class="p">(</span>
            <span class="n">json_schema</span><span class="o">=</span><span class="n">from_int_schema</span><span class="p">,</span>
            <span class="n">python_schema</span><span class="o">=</span><span class="n">core_schema</span><span class="o">.</span><span class="n">union_schema</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="c1"># check if it&#39;s an instance first before doing any further work</span>
                    <span class="n">core_schema</span><span class="o">.</span><span class="n">is_instance_schema</span><span class="p">(</span><span class="n">ThirdPartyType</span><span class="p">),</span>
                    <span class="n">from_int_schema</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">),</span>
            <span class="n">serialization</span><span class="o">=</span><span class="n">core_schema</span><span class="o">.</span><span class="n">plain_serializer_function_ser_schema</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">instance</span><span class="p">:</span> <span class="n">instance</span><span class="o">.</span><span class="n">x</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__get_pydantic_json_schema__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">_core_schema</span><span class="p">:</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">,</span> <span class="n">handler</span><span class="p">:</span> <span class="n">GetJsonSchemaHandler</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JsonSchemaValue</span><span class="p">:</span>
        <span class="c1"># Use the same schema that would be used for `int`</span>
        <span class="k">return</span> <span class="n">handler</span><span class="p">(</span><span class="n">core_schema</span><span class="o">.</span><span class="n">int_schema</span><span class="p">())</span>


<span class="c1"># We now create an `Annotated` wrapper that we&#39;ll use as the annotation for fields on `BaseModel`s, etc.</span>
<span class="n">PydanticThirdPartyType</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span>
    <span class="n">ThirdPartyType</span><span class="p">,</span> <span class="n">_ThirdPartyTypePydanticAnnotation</span>
<span class="p">]</span>


<span class="c1"># Create a model class that uses this annotation as a field</span>
<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">third_party_type</span><span class="p">:</span> <span class="n">PydanticThirdPartyType</span>


<span class="c1"># Demonstrate that this field is handled correctly, that ints are parsed into `ThirdPartyType`, and that</span>
<span class="c1"># these instances are also &quot;dumped&quot; directly into ints as expected.</span>
<span class="n">m_int</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">third_party_type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m_int</span><span class="o">.</span><span class="n">third_party_type</span><span class="p">,</span> <span class="n">ThirdPartyType</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">m_int</span><span class="o">.</span><span class="n">third_party_type</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="mi">1</span>
<span class="k">assert</span> <span class="n">m_int</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;third_party_type&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

<span class="c1"># Do the same thing where an instance of ThirdPartyType is passed in</span>
<span class="n">instance</span> <span class="o">=</span> <span class="n">ThirdPartyType</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">instance</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="mi">0</span>
<span class="n">instance</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">m_instance</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">third_party_type</span><span class="o">=</span><span class="n">instance</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m_instance</span><span class="o">.</span><span class="n">third_party_type</span><span class="p">,</span> <span class="n">ThirdPartyType</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">m_instance</span><span class="o">.</span><span class="n">third_party_type</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="mi">10</span>
<span class="k">assert</span> <span class="n">m_instance</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;third_party_type&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>

<span class="c1"># Demonstrate that validation errors are raised as expected for invalid inputs</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">Model</span><span class="p">(</span><span class="n">third_party_type</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    2 validation errors for Model</span>
<span class="sd">    third_party_type.is-instance[ThirdPartyType]</span>
<span class="sd">      Input should be an instance of ThirdPartyType [type=is_instance_of, input_value=&#39;a&#39;, input_type=str]</span>
<span class="sd">    third_party_type.chain[int,function-plain[validate_from_int()]]</span>
<span class="sd">      Input should be a valid integer, unable to parse string as an integer [type=int_parsing, input_value=&#39;a&#39;, input_type=str]</span>
<span class="sd">    &quot;&quot;&quot;</span>


<span class="k">assert</span> <span class="n">Model</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;third_party_type&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Third Party Type&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;integer&#39;</span><span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;third_party_type&#39;</span><span class="p">],</span>
    <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Model&#39;</span><span class="p">,</span>
    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">Any</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Callable</span>

<span class="kn">from</span> <span class="nn">pydantic_core</span> <span class="kn">import</span> <span class="n">core_schema</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Annotated</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">BaseModel</span><span class="p">,</span>
    <span class="n">GetJsonSchemaHandler</span><span class="p">,</span>
    <span class="n">ValidationError</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pydantic.json_schema</span> <span class="kn">import</span> <span class="n">JsonSchemaValue</span>


<span class="k">class</span> <span class="nc">ThirdPartyType</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is meant to represent a type from a third-party library that wasn&#39;t designed with Pydantic</span>
<span class="sd">    integration in mind, and so doesn&#39;t have a `pydantic_core.CoreSchema` or anything.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">x</span><span class="p">:</span> <span class="nb">int</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>


<span class="k">class</span> <span class="nc">_ThirdPartyTypePydanticAnnotation</span><span class="p">:</span>
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__get_pydantic_core_schema__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">_source_type</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">_handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        We return a pydantic_core.CoreSchema that behaves in the following ways:</span>

<span class="sd">        * ints will be parsed as `ThirdPartyType` instances with the int as the x attribute</span>
<span class="sd">        * `ThirdPartyType` instances will be parsed as `ThirdPartyType` instances without any changes</span>
<span class="sd">        * Nothing else will pass validation</span>
<span class="sd">        * Serialization will always return just an int</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">validate_from_int</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ThirdPartyType</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">ThirdPartyType</span><span class="p">()</span>
            <span class="n">result</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="n">from_int_schema</span> <span class="o">=</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">chain_schema</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">core_schema</span><span class="o">.</span><span class="n">int_schema</span><span class="p">(),</span>
                <span class="n">core_schema</span><span class="o">.</span><span class="n">no_info_plain_validator_function</span><span class="p">(</span><span class="n">validate_from_int</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">json_or_python_schema</span><span class="p">(</span>
            <span class="n">json_schema</span><span class="o">=</span><span class="n">from_int_schema</span><span class="p">,</span>
            <span class="n">python_schema</span><span class="o">=</span><span class="n">core_schema</span><span class="o">.</span><span class="n">union_schema</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="c1"># check if it&#39;s an instance first before doing any further work</span>
                    <span class="n">core_schema</span><span class="o">.</span><span class="n">is_instance_schema</span><span class="p">(</span><span class="n">ThirdPartyType</span><span class="p">),</span>
                    <span class="n">from_int_schema</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">),</span>
            <span class="n">serialization</span><span class="o">=</span><span class="n">core_schema</span><span class="o">.</span><span class="n">plain_serializer_function_ser_schema</span><span class="p">(</span>
                <span class="k">lambda</span> <span class="n">instance</span><span class="p">:</span> <span class="n">instance</span><span class="o">.</span><span class="n">x</span>
            <span class="p">),</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__get_pydantic_json_schema__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">_core_schema</span><span class="p">:</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">,</span> <span class="n">handler</span><span class="p">:</span> <span class="n">GetJsonSchemaHandler</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JsonSchemaValue</span><span class="p">:</span>
        <span class="c1"># Use the same schema that would be used for `int`</span>
        <span class="k">return</span> <span class="n">handler</span><span class="p">(</span><span class="n">core_schema</span><span class="o">.</span><span class="n">int_schema</span><span class="p">())</span>


<span class="c1"># We now create an `Annotated` wrapper that we&#39;ll use as the annotation for fields on `BaseModel`s, etc.</span>
<span class="n">PydanticThirdPartyType</span> <span class="o">=</span> <span class="n">Annotated</span><span class="p">[</span>
    <span class="n">ThirdPartyType</span><span class="p">,</span> <span class="n">_ThirdPartyTypePydanticAnnotation</span>
<span class="p">]</span>


<span class="c1"># Create a model class that uses this annotation as a field</span>
<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">third_party_type</span><span class="p">:</span> <span class="n">PydanticThirdPartyType</span>


<span class="c1"># Demonstrate that this field is handled correctly, that ints are parsed into `ThirdPartyType`, and that</span>
<span class="c1"># these instances are also &quot;dumped&quot; directly into ints as expected.</span>
<span class="n">m_int</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">third_party_type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m_int</span><span class="o">.</span><span class="n">third_party_type</span><span class="p">,</span> <span class="n">ThirdPartyType</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">m_int</span><span class="o">.</span><span class="n">third_party_type</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="mi">1</span>
<span class="k">assert</span> <span class="n">m_int</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;third_party_type&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

<span class="c1"># Do the same thing where an instance of ThirdPartyType is passed in</span>
<span class="n">instance</span> <span class="o">=</span> <span class="n">ThirdPartyType</span><span class="p">()</span>
<span class="k">assert</span> <span class="n">instance</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="mi">0</span>
<span class="n">instance</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">m_instance</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">third_party_type</span><span class="o">=</span><span class="n">instance</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m_instance</span><span class="o">.</span><span class="n">third_party_type</span><span class="p">,</span> <span class="n">ThirdPartyType</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">m_instance</span><span class="o">.</span><span class="n">third_party_type</span><span class="o">.</span><span class="n">x</span> <span class="o">==</span> <span class="mi">10</span>
<span class="k">assert</span> <span class="n">m_instance</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span><span class="s1">&#39;third_party_type&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">}</span>

<span class="c1"># Demonstrate that validation errors are raised as expected for invalid inputs</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">Model</span><span class="p">(</span><span class="n">third_party_type</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    2 validation errors for Model</span>
<span class="sd">    third_party_type.is-instance[ThirdPartyType]</span>
<span class="sd">      Input should be an instance of ThirdPartyType [type=is_instance_of, input_value=&#39;a&#39;, input_type=str]</span>
<span class="sd">    third_party_type.chain[int,function-plain[validate_from_int()]]</span>
<span class="sd">      Input should be a valid integer, unable to parse string as an integer [type=int_parsing, input_value=&#39;a&#39;, input_type=str]</span>
<span class="sd">    &quot;&quot;&quot;</span>


<span class="k">assert</span> <span class="n">Model</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span>
    <span class="s1">&#39;properties&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;third_party_type&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Third Party Type&#39;</span><span class="p">,</span> <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;integer&#39;</span><span class="p">}</span>
    <span class="p">},</span>
    <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;third_party_type&#39;</span><span class="p">],</span>
    <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Model&#39;</span><span class="p">,</span>
    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;object&#39;</span><span class="p">,</span>
<span class="p">}</span>
</code></pre></div>
</div>
</div>
</div>
<p>You can use this approach to e.g. define behavior for Pandas or Numpy types.</p>
<h2 id="creating-custom-classes-using-__get_pydantic_core_schema__">Creating custom classes using <code>__get_pydantic_core_schema__</code><a class="headerlink" href="#creating-custom-classes-using-__get_pydantic_core_schema__" title="Permanent link">&para;</a></h2>
<p>To do more extensive customization of how Pydantic handles custom classes, and in particular when you have access to the
class or can subclass it, you can implement a special <code>__get_pydantic_core_schema__</code> to tell Pydantic how to generate the
<code>pydantic-core</code> schema.</p>
<p>While <code>pydantic</code> uses <code>pydantic-core</code> internally to handle validation and serialization, it is a new API for Pydantic V2,
thus it is one of the areas most likely to be tweaked in the future and you should try to stick to the built in
constructs like those provided by <code>annotated-types</code>, <code>pydantic.Field</code>, or <code>BeforeValidator</code> and so on.</p>
<p>You can implement <code>__get_pydantic_core_schema__</code> both on a custom type and on metadata intended to be put in <code>Annotated</code>.
In both cases the API is middleware-like and similar to that of "wrap" validators: you get a <code>source_type</code> (which isn't
necessarily the same as the class, in particular for generics) and a <code>handler</code> that you can call with a type to either
call the next metadata in <code>Annotated</code> or call into Pydantic's internal schema generation.</p>
<p>The simplest no-op implementation calls the handler with the type you are given, then returns that as the result. You can
also choose to modify the type before calling the handler, modify the core schema returned by the handler or not call the
handler at all.</p>
<p>Here is an example of an annotation intended to go into <code>Annotated</code> that enforces that a string is a valid postal code.
The advantage of doing this via an annotation in <code>Annotated</code> instead of making a <code>PostalCode(str)</code> class is that any
<code>str</code> can be passed into a model constructor and type checkers will not complain, but Pydantic will still enforce
validation.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="9:2"><input checked="checked" id="__tabbed_9_1" name="__tabbed_9" type="radio" /><input id="__tabbed_9_2" name="__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="__tabbed_9_1">Python 3.7 and above</label><label for="__tabbed_9_2">Python 3.9 and above</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<span class="kn">from</span> <span class="nn">pydantic_core</span> <span class="kn">import</span> <span class="n">PydanticCustomError</span><span class="p">,</span> <span class="n">core_schema</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Annotated</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">BaseModel</span><span class="p">,</span>
    <span class="n">GetCoreSchemaHandler</span><span class="p">,</span>
    <span class="n">GetJsonSchemaHandler</span><span class="p">,</span>
    <span class="n">ValidationError</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pydantic.json_schema</span> <span class="kn">import</span> <span class="n">JsonSchemaValue</span>

<span class="c1"># https://en.wikipedia.org/wiki/Postcodes_in_the_United_Kingdom#Validation</span>
<span class="n">post_code_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="sa">r</span><span class="s1">&#39;(?:&#39;</span>
    <span class="sa">r</span><span class="s1">&#39;([A-Z]{1,2}[0-9][A-Z0-9]?|ASCN|STHL|TDCU|BBND|[BFS]IQQ|PCRN|TKCA) ?&#39;</span>
    <span class="sa">r</span><span class="s1">&#39;([0-9][A-Z]</span><span class="si">{2}</span><span class="s1">)|&#39;</span>
    <span class="sa">r</span><span class="s1">&#39;(BFPO) ?([0-9]{1,4})|&#39;</span>
    <span class="sa">r</span><span class="s1">&#39;(KY[0-9]|MSR|VG|AI)[ -]?[0-9]</span><span class="si">{4}</span><span class="s1">|&#39;</span>
    <span class="sa">r</span><span class="s1">&#39;([A-Z]</span><span class="si">{2}</span><span class="s1">) ?([0-9]</span><span class="si">{2}</span><span class="s1">)|&#39;</span>
    <span class="sa">r</span><span class="s1">&#39;(GE) ?(CX)|&#39;</span>
    <span class="sa">r</span><span class="s1">&#39;(GIR) ?(0A</span><span class="si">{2}</span><span class="s1">)|&#39;</span>
    <span class="sa">r</span><span class="s1">&#39;(SAN) ?(TA1)&#39;</span>
    <span class="sa">r</span><span class="s1">&#39;)&#39;</span>
<span class="p">)</span>


<span class="k">class</span> <span class="nc">PostCodeAnnotation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Partial UK postcode validation. Note: this is just an example, and is not</span>
<span class="sd">    intended for use in production; in particular this does NOT guarantee</span>
<span class="sd">    a postcode exists, just that it has a valid format.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__get_pydantic_core_schema__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">_source_type</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">_handler</span><span class="p">:</span> <span class="n">GetCoreSchemaHandler</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">no_info_after_validator_function</span><span class="p">(</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">validate</span><span class="p">,</span>
            <span class="n">core_schema</span><span class="o">.</span><span class="n">str_schema</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__get_pydantic_json_schema__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">,</span> <span class="n">handler</span><span class="p">:</span> <span class="n">GetJsonSchemaHandler</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JsonSchemaValue</span><span class="p">:</span>
        <span class="n">json_schema</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
        <span class="n">json_schema</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="c1"># simplified regex here for brevity, see the wikipedia link above</span>
            <span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;^[A-Z]{1,2}[0-9][A-Z0-9]? ?[0-9][A-Z]</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">,</span>
            <span class="c1"># some example postcodes</span>
            <span class="n">examples</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;SP11 9DG&#39;</span><span class="p">,</span> <span class="s1">&#39;W1J 7BU&#39;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">json_schema</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">post_code_regex</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PydanticCustomError</span><span class="p">(</span><span class="s1">&#39;postcode&#39;</span><span class="p">,</span> <span class="s1">&#39;invalid postcode format&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">post_code</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">PostCodeAnnotation</span><span class="p">]</span>


<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">post_code</span><span class="o">=</span><span class="s1">&#39;sw8 5el&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="c1">#&gt; post_code=&#39;SW8 5EL&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">post_code</span><span class="p">)</span>
<span class="c1">#&gt; SW8 5EL</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">())</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{</span>
<span class="sd">    &#39;properties&#39;: {</span>
<span class="sd">        &#39;post_code&#39;: {</span>
<span class="sd">            &#39;examples&#39;: [&#39;SP11 9DG&#39;, &#39;W1J 7BU&#39;],</span>
<span class="sd">            &#39;pattern&#39;: &#39;^[A-Z]{1,2}[0-9][A-Z0-9]? ?[0-9][A-Z]{2}$&#39;,</span>
<span class="sd">            &#39;title&#39;: &#39;Post Code&#39;,</span>
<span class="sd">            &#39;type&#39;: &#39;string&#39;,</span>
<span class="sd">        }</span>
<span class="sd">    },</span>
<span class="sd">    &#39;required&#39;: [&#39;post_code&#39;],</span>
<span class="sd">    &#39;title&#39;: &#39;Model&#39;,</span>
<span class="sd">    &#39;type&#39;: &#39;object&#39;,</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">Model</span><span class="p">(</span><span class="n">post_code</span><span class="o">=</span><span class="s1">&#39;invalid&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errors</span><span class="p">())</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    [</span>
<span class="sd">        {</span>
<span class="sd">            &#39;type&#39;: &#39;postcode&#39;,</span>
<span class="sd">            &#39;loc&#39;: (&#39;post_code&#39;,),</span>
<span class="sd">            &#39;msg&#39;: &#39;invalid postcode format&#39;,</span>
<span class="sd">            &#39;input&#39;: &#39;invalid&#39;,</span>
<span class="sd">        }</span>
<span class="sd">    ]</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>

<span class="kn">from</span> <span class="nn">pydantic_core</span> <span class="kn">import</span> <span class="n">PydanticCustomError</span><span class="p">,</span> <span class="n">core_schema</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Annotated</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">BaseModel</span><span class="p">,</span>
    <span class="n">GetCoreSchemaHandler</span><span class="p">,</span>
    <span class="n">GetJsonSchemaHandler</span><span class="p">,</span>
    <span class="n">ValidationError</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">pydantic.json_schema</span> <span class="kn">import</span> <span class="n">JsonSchemaValue</span>

<span class="c1"># https://en.wikipedia.org/wiki/Postcodes_in_the_United_Kingdom#Validation</span>
<span class="n">post_code_regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span>
    <span class="sa">r</span><span class="s1">&#39;(?:&#39;</span>
    <span class="sa">r</span><span class="s1">&#39;([A-Z]{1,2}[0-9][A-Z0-9]?|ASCN|STHL|TDCU|BBND|[BFS]IQQ|PCRN|TKCA) ?&#39;</span>
    <span class="sa">r</span><span class="s1">&#39;([0-9][A-Z]</span><span class="si">{2}</span><span class="s1">)|&#39;</span>
    <span class="sa">r</span><span class="s1">&#39;(BFPO) ?([0-9]{1,4})|&#39;</span>
    <span class="sa">r</span><span class="s1">&#39;(KY[0-9]|MSR|VG|AI)[ -]?[0-9]</span><span class="si">{4}</span><span class="s1">|&#39;</span>
    <span class="sa">r</span><span class="s1">&#39;([A-Z]</span><span class="si">{2}</span><span class="s1">) ?([0-9]</span><span class="si">{2}</span><span class="s1">)|&#39;</span>
    <span class="sa">r</span><span class="s1">&#39;(GE) ?(CX)|&#39;</span>
    <span class="sa">r</span><span class="s1">&#39;(GIR) ?(0A</span><span class="si">{2}</span><span class="s1">)|&#39;</span>
    <span class="sa">r</span><span class="s1">&#39;(SAN) ?(TA1)&#39;</span>
    <span class="sa">r</span><span class="s1">&#39;)&#39;</span>
<span class="p">)</span>


<span class="k">class</span> <span class="nc">PostCodeAnnotation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Partial UK postcode validation. Note: this is just an example, and is not</span>
<span class="sd">    intended for use in production; in particular this does NOT guarantee</span>
<span class="sd">    a postcode exists, just that it has a valid format.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__get_pydantic_core_schema__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">_source_type</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">_handler</span><span class="p">:</span> <span class="n">GetCoreSchemaHandler</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">no_info_after_validator_function</span><span class="p">(</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">validate</span><span class="p">,</span>
            <span class="n">core_schema</span><span class="o">.</span><span class="n">str_schema</span><span class="p">(),</span>
        <span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__get_pydantic_json_schema__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">schema</span><span class="p">:</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">,</span> <span class="n">handler</span><span class="p">:</span> <span class="n">GetJsonSchemaHandler</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">JsonSchemaValue</span><span class="p">:</span>
        <span class="n">json_schema</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="n">schema</span><span class="p">)</span>
        <span class="n">json_schema</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="c1"># simplified regex here for brevity, see the wikipedia link above</span>
            <span class="n">pattern</span><span class="o">=</span><span class="s1">&#39;^[A-Z]{1,2}[0-9][A-Z0-9]? ?[0-9][A-Z]</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">,</span>
            <span class="c1"># some example postcodes</span>
            <span class="n">examples</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;SP11 9DG&#39;</span><span class="p">,</span> <span class="s1">&#39;W1J 7BU&#39;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">json_schema</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">post_code_regex</span><span class="o">.</span><span class="n">fullmatch</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">PydanticCustomError</span><span class="p">(</span><span class="s1">&#39;postcode&#39;</span><span class="p">,</span> <span class="s1">&#39;invalid postcode format&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">post_code</span><span class="p">:</span> <span class="n">Annotated</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">PostCodeAnnotation</span><span class="p">]</span>


<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">post_code</span><span class="o">=</span><span class="s1">&#39;sw8 5el&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="c1">#&gt; post_code=&#39;SW8 5EL&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">post_code</span><span class="p">)</span>
<span class="c1">#&gt; SW8 5EL</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">model_json_schema</span><span class="p">())</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">{</span>
<span class="sd">    &#39;properties&#39;: {</span>
<span class="sd">        &#39;post_code&#39;: {</span>
<span class="sd">            &#39;examples&#39;: [&#39;SP11 9DG&#39;, &#39;W1J 7BU&#39;],</span>
<span class="sd">            &#39;pattern&#39;: &#39;^[A-Z]{1,2}[0-9][A-Z0-9]? ?[0-9][A-Z]{2}$&#39;,</span>
<span class="sd">            &#39;title&#39;: &#39;Post Code&#39;,</span>
<span class="sd">            &#39;type&#39;: &#39;string&#39;,</span>
<span class="sd">        }</span>
<span class="sd">    },</span>
<span class="sd">    &#39;required&#39;: [&#39;post_code&#39;],</span>
<span class="sd">    &#39;title&#39;: &#39;Model&#39;,</span>
<span class="sd">    &#39;type&#39;: &#39;object&#39;,</span>
<span class="sd">}</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">Model</span><span class="p">(</span><span class="n">post_code</span><span class="o">=</span><span class="s1">&#39;invalid&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errors</span><span class="p">())</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    [</span>
<span class="sd">        {</span>
<span class="sd">            &#39;type&#39;: &#39;postcode&#39;,</span>
<span class="sd">            &#39;loc&#39;: (&#39;post_code&#39;,),</span>
<span class="sd">            &#39;msg&#39;: &#39;invalid postcode format&#39;,</span>
<span class="sd">            &#39;input&#39;: &#39;invalid&#39;,</span>
<span class="sd">        }</span>
<span class="sd">    ]</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
</div>
</div>
</div>
<p>Similar validation could be achieved using <a href="../../fields/#string-constraints"><code>Annotated[str, Field(pattern=...)]</code></a> except
the value won't be formatted with a space, the schema would just include the full pattern and the returned value would be
a vanilla string.</p>
<p>See <a href="../../json_schema/">schema</a> for more details on how the model's schema is generated.</p>
<h2 id="generic-classes-as-types">Generic classes as types<a class="headerlink" href="#generic-classes-as-types" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This is an advanced technique that you might not need in the beginning. In most of
the cases you will probably be fine with standard Pydantic models.</p>
</div>
<p>You can use
<a href="https://docs.python.org/3/library/typing.html#typing.Generic">Generic Classes</a> as
field types and perform custom validation based on the "type parameters" (or sub-types)
with <code>__get_pydantic_core_schema__</code>.</p>
<p>If the Generic class that you are using as a sub-type has a classmethod
<code>__get_pydantic_core_schema__</code>, you don't need to use
<a href="../../model_config/#arbitrary-types-allowed"><code>arbitrary_types_allowed</code></a> for it to work.</p>
<p>Because the <code>source_type</code> parameter is not the same as the <code>cls</code> parameter, you can use <code>typing.get_args</code> (or <code>typing_extensions.get_args</code>) to extract the generic parameters.
Then you can use the <code>handler</code> to generate a schema for them by calling <code>handler.generate_schema</code>.
Note that we do not do something like <code>handler(get_args(source_type)[0])</code> because we want to generate an unrelated
schema for that generic parameter, not one that is influenced by the current context of <code>Annotated</code> metadata and such.
This is less important for custom types, but crucial for annotated metadata that modifies schema building.</p>
<div class="tabbed-set tabbed-alternate" data-tabs="10:2"><input checked="checked" id="__tabbed_10_1" name="__tabbed_10" type="radio" /><input id="__tabbed_10_2" name="__tabbed_10" type="radio" /><div class="tabbed-labels"><label for="__tabbed_10_1">Python 3.7 and above</label><label for="__tabbed_10_2">Python 3.10 and above</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Generic</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="kn">from</span> <span class="nn">pydantic_core</span> <span class="kn">import</span> <span class="n">CoreSchema</span><span class="p">,</span> <span class="n">core_schema</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">get_args</span><span class="p">,</span> <span class="n">get_origin</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">BaseModel</span><span class="p">,</span>
    <span class="n">GetCoreSchemaHandler</span><span class="p">,</span>
    <span class="n">ValidationError</span><span class="p">,</span>
    <span class="n">ValidatorFunctionWrapHandler</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ItemType</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;ItemType&#39;</span><span class="p">)</span>


<span class="c1"># This is not a pydantic model, it&#39;s an arbitrary generic class</span>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Owner</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">ItemType</span><span class="p">]):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">item</span><span class="p">:</span> <span class="n">ItemType</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__get_pydantic_core_schema__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">source_type</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">handler</span><span class="p">:</span> <span class="n">GetCoreSchemaHandler</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CoreSchema</span><span class="p">:</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="n">get_origin</span><span class="p">(</span><span class="n">source_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">origin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># used as `x: Owner` without params</span>
            <span class="n">origin</span> <span class="o">=</span> <span class="n">source_type</span>
            <span class="n">item_tp</span> <span class="o">=</span> <span class="n">Any</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">item_tp</span> <span class="o">=</span> <span class="n">get_args</span><span class="p">(</span><span class="n">source_type</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># both calling handler(...) and handler.generate_schema(...)</span>
        <span class="c1"># would work, but prefer the latter for conceptual and consistency reasons</span>
        <span class="n">item_schema</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">generate_schema</span><span class="p">(</span><span class="n">item_tp</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">val_item</span><span class="p">(</span>
            <span class="n">v</span><span class="p">:</span> <span class="n">Owner</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">handler</span><span class="p">:</span> <span class="n">ValidatorFunctionWrapHandler</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Owner</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
            <span class="n">v</span><span class="o">.</span><span class="n">item</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">item</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">v</span>

        <span class="n">python_schema</span> <span class="o">=</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">chain_schema</span><span class="p">(</span>
            <span class="c1"># `chain_schema` means do the following steps in order:</span>
            <span class="p">[</span>
                <span class="c1"># Ensure the value is an instance of Owner</span>
                <span class="n">core_schema</span><span class="o">.</span><span class="n">is_instance_schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">),</span>
                <span class="c1"># Use the item_schema to validate `items`</span>
                <span class="n">core_schema</span><span class="o">.</span><span class="n">no_info_wrap_validator_function</span><span class="p">(</span>
                    <span class="n">val_item</span><span class="p">,</span> <span class="n">item_schema</span>
                <span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">json_or_python_schema</span><span class="p">(</span>
            <span class="c1"># for JSON accept an object with name and item keys</span>
            <span class="n">json_schema</span><span class="o">=</span><span class="n">core_schema</span><span class="o">.</span><span class="n">chain_schema</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">core_schema</span><span class="o">.</span><span class="n">typed_dict_schema</span><span class="p">(</span>
                        <span class="p">{</span>
                            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">typed_dict_field</span><span class="p">(</span>
                                <span class="n">core_schema</span><span class="o">.</span><span class="n">str_schema</span><span class="p">()</span>
                            <span class="p">),</span>
                            <span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">typed_dict_field</span><span class="p">(</span><span class="n">item_schema</span><span class="p">),</span>
                        <span class="p">}</span>
                    <span class="p">),</span>
                    <span class="c1"># after validating the json data convert it to python</span>
                    <span class="n">core_schema</span><span class="o">.</span><span class="n">no_info_before_validator_function</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">Owner</span><span class="p">(</span>
                            <span class="n">name</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">item</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span>
                        <span class="p">),</span>
                        <span class="c1"># note that we re-use the same schema here as below</span>
                        <span class="n">python_schema</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">]</span>
            <span class="p">),</span>
            <span class="n">python_schema</span><span class="o">=</span><span class="n">python_schema</span><span class="p">,</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">Car</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">color</span><span class="p">:</span> <span class="nb">str</span>


<span class="k">class</span> <span class="nc">House</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">rooms</span><span class="p">:</span> <span class="nb">int</span>


<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">car_owner</span><span class="p">:</span> <span class="n">Owner</span><span class="p">[</span><span class="n">Car</span><span class="p">]</span>
    <span class="n">home_owner</span><span class="p">:</span> <span class="n">Owner</span><span class="p">[</span><span class="n">House</span><span class="p">]</span>


<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span>
    <span class="n">car_owner</span><span class="o">=</span><span class="n">Owner</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">Car</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)),</span>
    <span class="n">home_owner</span><span class="o">=</span><span class="n">Owner</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;James&#39;</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">House</span><span class="p">(</span><span class="n">rooms</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">car_owner=Owner(name=&#39;John&#39;, item=Car(color=&#39;black&#39;)) home_owner=Owner(name=&#39;James&#39;, item=House(rooms=3))</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># If the values of the sub-types are invalid, we get an error</span>
    <span class="n">Model</span><span class="p">(</span>
        <span class="n">car_owner</span><span class="o">=</span><span class="n">Owner</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">House</span><span class="p">(</span><span class="n">rooms</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
        <span class="n">home_owner</span><span class="o">=</span><span class="n">Owner</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;James&#39;</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">Car</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)),</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    2 validation errors for Model</span>
<span class="sd">    wine</span>
<span class="sd">      Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value=&#39;Kinda good&#39;, input_type=str]</span>
<span class="sd">    cheese</span>
<span class="sd">      Input should be a valid boolean, unable to interpret input [type=bool_parsing, input_value=&#39;yeah&#39;, input_type=str]</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="c1"># Similarly with JSON</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="o">.</span><span class="n">model_validate_json</span><span class="p">(</span>
    <span class="s1">&#39;{&quot;car_owner&quot;:{&quot;name&quot;:&quot;John&quot;,&quot;item&quot;:{&quot;color&quot;:&quot;black&quot;}},&quot;home_owner&quot;:{&quot;name&quot;:&quot;James&quot;,&quot;item&quot;:{&quot;rooms&quot;:3}}}&#39;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">car_owner=Owner(name=&#39;John&#39;, item=Car(color=&#39;black&#39;)) home_owner=Owner(name=&#39;James&#39;, item=House(rooms=3))</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">Model</span><span class="o">.</span><span class="n">model_validate_json</span><span class="p">(</span>
        <span class="s1">&#39;{&quot;car_owner&quot;:{&quot;name&quot;:&quot;John&quot;,&quot;item&quot;:{&quot;rooms&quot;:3}},&quot;home_owner&quot;:{&quot;name&quot;:&quot;James&quot;,&quot;item&quot;:{&quot;color&quot;:&quot;black&quot;}}}&#39;</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    2 validation errors for Model</span>
<span class="sd">    car_owner.item.color</span>
<span class="sd">      Field required [type=missing, input_value={&#39;rooms&#39;: 3}, input_type=dict]</span>
<span class="sd">    home_owner.item.rooms</span>
<span class="sd">      Field required [type=missing, input_value={&#39;color&#39;: &#39;black&#39;}, input_type=dict]</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Generic</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="kn">from</span> <span class="nn">pydantic_core</span> <span class="kn">import</span> <span class="n">CoreSchema</span><span class="p">,</span> <span class="n">core_schema</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">get_args</span><span class="p">,</span> <span class="n">get_origin</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">BaseModel</span><span class="p">,</span>
    <span class="n">GetCoreSchemaHandler</span><span class="p">,</span>
    <span class="n">ValidationError</span><span class="p">,</span>
    <span class="n">ValidatorFunctionWrapHandler</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ItemType</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;ItemType&#39;</span><span class="p">)</span>


<span class="c1"># This is not a pydantic model, it&#39;s an arbitrary generic class</span>
<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Owner</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">ItemType</span><span class="p">]):</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">item</span><span class="p">:</span> <span class="n">ItemType</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__get_pydantic_core_schema__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">source_type</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">handler</span><span class="p">:</span> <span class="n">GetCoreSchemaHandler</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CoreSchema</span><span class="p">:</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="n">get_origin</span><span class="p">(</span><span class="n">source_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">origin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># used as `x: Owner` without params</span>
            <span class="n">origin</span> <span class="o">=</span> <span class="n">source_type</span>
            <span class="n">item_tp</span> <span class="o">=</span> <span class="n">Any</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">item_tp</span> <span class="o">=</span> <span class="n">get_args</span><span class="p">(</span><span class="n">source_type</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># both calling handler(...) and handler.generate_schema(...)</span>
        <span class="c1"># would work, but prefer the latter for conceptual and consistency reasons</span>
        <span class="n">item_schema</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">generate_schema</span><span class="p">(</span><span class="n">item_tp</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">val_item</span><span class="p">(</span>
            <span class="n">v</span><span class="p">:</span> <span class="n">Owner</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">handler</span><span class="p">:</span> <span class="n">ValidatorFunctionWrapHandler</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Owner</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
            <span class="n">v</span><span class="o">.</span><span class="n">item</span> <span class="o">=</span> <span class="n">handler</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">item</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">v</span>

        <span class="n">python_schema</span> <span class="o">=</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">chain_schema</span><span class="p">(</span>
            <span class="c1"># `chain_schema` means do the following steps in order:</span>
            <span class="p">[</span>
                <span class="c1"># Ensure the value is an instance of Owner</span>
                <span class="n">core_schema</span><span class="o">.</span><span class="n">is_instance_schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">),</span>
                <span class="c1"># Use the item_schema to validate `items`</span>
                <span class="n">core_schema</span><span class="o">.</span><span class="n">no_info_wrap_validator_function</span><span class="p">(</span>
                    <span class="n">val_item</span><span class="p">,</span> <span class="n">item_schema</span>
                <span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">json_or_python_schema</span><span class="p">(</span>
            <span class="c1"># for JSON accept an object with name and item keys</span>
            <span class="n">json_schema</span><span class="o">=</span><span class="n">core_schema</span><span class="o">.</span><span class="n">chain_schema</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">core_schema</span><span class="o">.</span><span class="n">typed_dict_schema</span><span class="p">(</span>
                        <span class="p">{</span>
                            <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">typed_dict_field</span><span class="p">(</span>
                                <span class="n">core_schema</span><span class="o">.</span><span class="n">str_schema</span><span class="p">()</span>
                            <span class="p">),</span>
                            <span class="s1">&#39;item&#39;</span><span class="p">:</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">typed_dict_field</span><span class="p">(</span><span class="n">item_schema</span><span class="p">),</span>
                        <span class="p">}</span>
                    <span class="p">),</span>
                    <span class="c1"># after validating the json data convert it to python</span>
                    <span class="n">core_schema</span><span class="o">.</span><span class="n">no_info_before_validator_function</span><span class="p">(</span>
                        <span class="k">lambda</span> <span class="n">data</span><span class="p">:</span> <span class="n">Owner</span><span class="p">(</span>
                            <span class="n">name</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">item</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;item&#39;</span><span class="p">]</span>
                        <span class="p">),</span>
                        <span class="c1"># note that we re-use the same schema here as below</span>
                        <span class="n">python_schema</span><span class="p">,</span>
                    <span class="p">),</span>
                <span class="p">]</span>
            <span class="p">),</span>
            <span class="n">python_schema</span><span class="o">=</span><span class="n">python_schema</span><span class="p">,</span>
        <span class="p">)</span>


<span class="k">class</span> <span class="nc">Car</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">color</span><span class="p">:</span> <span class="nb">str</span>


<span class="k">class</span> <span class="nc">House</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">rooms</span><span class="p">:</span> <span class="nb">int</span>


<span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">car_owner</span><span class="p">:</span> <span class="n">Owner</span><span class="p">[</span><span class="n">Car</span><span class="p">]</span>
    <span class="n">home_owner</span><span class="p">:</span> <span class="n">Owner</span><span class="p">[</span><span class="n">House</span><span class="p">]</span>


<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span>
    <span class="n">car_owner</span><span class="o">=</span><span class="n">Owner</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">Car</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)),</span>
    <span class="n">home_owner</span><span class="o">=</span><span class="n">Owner</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;James&#39;</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">House</span><span class="p">(</span><span class="n">rooms</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">car_owner=Owner(name=&#39;John&#39;, item=Car(color=&#39;black&#39;)) home_owner=Owner(name=&#39;James&#39;, item=House(rooms=3))</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="c1"># If the values of the sub-types are invalid, we get an error</span>
    <span class="n">Model</span><span class="p">(</span>
        <span class="n">car_owner</span><span class="o">=</span><span class="n">Owner</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;John&#39;</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">House</span><span class="p">(</span><span class="n">rooms</span><span class="o">=</span><span class="mi">3</span><span class="p">)),</span>
        <span class="n">home_owner</span><span class="o">=</span><span class="n">Owner</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;James&#39;</span><span class="p">,</span> <span class="n">item</span><span class="o">=</span><span class="n">Car</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)),</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    2 validation errors for Model</span>
<span class="sd">    wine</span>
<span class="sd">      Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value=&#39;Kinda good&#39;, input_type=str]</span>
<span class="sd">    cheese</span>
<span class="sd">      Input should be a valid boolean, unable to interpret input [type=bool_parsing, input_value=&#39;yeah&#39;, input_type=str]</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="c1"># Similarly with JSON</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="o">.</span><span class="n">model_validate_json</span><span class="p">(</span>
    <span class="s1">&#39;{&quot;car_owner&quot;:{&quot;name&quot;:&quot;John&quot;,&quot;item&quot;:{&quot;color&quot;:&quot;black&quot;}},&quot;home_owner&quot;:{&quot;name&quot;:&quot;James&quot;,&quot;item&quot;:{&quot;rooms&quot;:3}}}&#39;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">car_owner=Owner(name=&#39;John&#39;, item=Car(color=&#39;black&#39;)) home_owner=Owner(name=&#39;James&#39;, item=House(rooms=3))</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">Model</span><span class="o">.</span><span class="n">model_validate_json</span><span class="p">(</span>
        <span class="s1">&#39;{&quot;car_owner&quot;:{&quot;name&quot;:&quot;John&quot;,&quot;item&quot;:{&quot;rooms&quot;:3}},&quot;home_owner&quot;:{&quot;name&quot;:&quot;James&quot;,&quot;item&quot;:{&quot;color&quot;:&quot;black&quot;}}}&#39;</span>
    <span class="p">)</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    2 validation errors for Model</span>
<span class="sd">    car_owner.item.color</span>
<span class="sd">      Field required [type=missing, input_value={&#39;rooms&#39;: 3}, input_type=dict]</span>
<span class="sd">    home_owner.item.rooms</span>
<span class="sd">      Field required [type=missing, input_value={&#39;color&#39;: &#39;black&#39;}, input_type=dict]</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
</div>
</div>
</div>
<h3 id="generic-containers">Generic containers<a class="headerlink" href="#generic-containers" title="Permanent link">&para;</a></h3>
<p>The same idea can be applied to create generic container types, like a custom <code>Sequence</code> type:</p>
<div class="tabbed-set tabbed-alternate" data-tabs="11:3"><input checked="checked" id="__tabbed_11_1" name="__tabbed_11" type="radio" /><input id="__tabbed_11_2" name="__tabbed_11" type="radio" /><input id="__tabbed_11_3" name="__tabbed_11" type="radio" /><div class="tabbed-labels"><label for="__tabbed_11_1">Python 3.7 and above</label><label for="__tabbed_11_2">Python 3.9 and above</label><label for="__tabbed_11_3">Python 3.10 and above</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">TypeVar</span>

<span class="kn">from</span> <span class="nn">pydantic_core</span> <span class="kn">import</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">core_schema</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">get_args</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MySequence</span><span class="p">(</span><span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">v</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__get_pydantic_core_schema__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">:</span>
        <span class="n">instance_schema</span> <span class="o">=</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">is_instance_schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">get_args</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="c1"># replace the type and rely on Pydantic to generate the right schema</span>
            <span class="c1"># for `Sequence`</span>
            <span class="n">sequence_t_schema</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">generate_schema</span><span class="p">(</span><span class="n">Sequence</span><span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sequence_t_schema</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">generate_schema</span><span class="p">(</span><span class="n">Sequence</span><span class="p">)</span>

        <span class="n">non_instance_schema</span> <span class="o">=</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">general_after_validator_function</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">v</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">MySequence</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">sequence_t_schema</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">union_schema</span><span class="p">([</span><span class="n">instance_schema</span><span class="p">,</span> <span class="n">non_instance_schema</span><span class="p">])</span>


<span class="k">class</span> <span class="nc">M</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">validate_default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">s1</span><span class="p">:</span> <span class="n">MySequence</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span>


<span class="n">m</span> <span class="o">=</span> <span class="n">M</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="c1">#&gt; s1=&lt;__main__.MySequence object at 0x0123456789ab&gt;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">s1</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
<span class="c1">#&gt; [3]</span>


<span class="k">class</span> <span class="nc">M</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">s1</span><span class="p">:</span> <span class="n">MySequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>


<span class="n">M</span><span class="p">(</span><span class="n">s1</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">M</span><span class="p">(</span><span class="n">s1</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">])</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    2 validation errors for M</span>
<span class="sd">    s1.is-instance[MySequence]</span>
<span class="sd">      Input should be an instance of MySequence [type=is_instance_of, input_value=[&#39;a&#39;], input_type=list]</span>
<span class="sd">    s1.function-after[&lt;lambda&gt;(), json-or-python[json=list[int],python=chain[is-instance[Sequence],function-wrap[sequence_validator()]]]].0</span>
<span class="sd">      Input should be a valid integer, unable to parse string as an integer [type=int_parsing, input_value=&#39;a&#39;, input_type=str]</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">TypeVar</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Sequence</span>

<span class="kn">from</span> <span class="nn">pydantic_core</span> <span class="kn">import</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">core_schema</span>
<span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">get_args</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MySequence</span><span class="p">(</span><span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">v</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__get_pydantic_core_schema__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">:</span>
        <span class="n">instance_schema</span> <span class="o">=</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">is_instance_schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">get_args</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="c1"># replace the type and rely on Pydantic to generate the right schema</span>
            <span class="c1"># for `Sequence`</span>
            <span class="n">sequence_t_schema</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">generate_schema</span><span class="p">(</span><span class="n">Sequence</span><span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sequence_t_schema</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">generate_schema</span><span class="p">(</span><span class="n">Sequence</span><span class="p">)</span>

        <span class="n">non_instance_schema</span> <span class="o">=</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">general_after_validator_function</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">v</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">MySequence</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">sequence_t_schema</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">union_schema</span><span class="p">([</span><span class="n">instance_schema</span><span class="p">,</span> <span class="n">non_instance_schema</span><span class="p">])</span>


<span class="k">class</span> <span class="nc">M</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">validate_default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">s1</span><span class="p">:</span> <span class="n">MySequence</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span>


<span class="n">m</span> <span class="o">=</span> <span class="n">M</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="c1">#&gt; s1=&lt;__main__.MySequence object at 0x0123456789ab&gt;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">s1</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
<span class="c1">#&gt; [3]</span>


<span class="k">class</span> <span class="nc">M</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">s1</span><span class="p">:</span> <span class="n">MySequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>


<span class="n">M</span><span class="p">(</span><span class="n">s1</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">M</span><span class="p">(</span><span class="n">s1</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">])</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    2 validation errors for M</span>
<span class="sd">    s1.is-instance[MySequence]</span>
<span class="sd">      Input should be an instance of MySequence [type=is_instance_of, input_value=[&#39;a&#39;], input_type=list]</span>
<span class="sd">    s1.function-after[&lt;lambda&gt;(), json-or-python[json=list[int],python=chain[is-instance[Sequence],function-wrap[sequence_validator()]]]].0</span>
<span class="sd">      Input should be a valid integer, unable to parse string as an integer [type=int_parsing, input_value=&#39;a&#39;, input_type=str]</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
</div>
<div class="tabbed-block">
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">TypeVar</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Sequence</span>

<span class="kn">from</span> <span class="nn">pydantic_core</span> <span class="kn">import</span> <span class="n">ValidationError</span><span class="p">,</span> <span class="n">core_schema</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">get_args</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">TypeVar</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MySequence</span><span class="p">(</span><span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v</span> <span class="o">=</span> <span class="n">v</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">__get_pydantic_core_schema__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">CoreSchema</span><span class="p">:</span>
        <span class="n">instance_schema</span> <span class="o">=</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">is_instance_schema</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

        <span class="n">args</span> <span class="o">=</span> <span class="n">get_args</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="c1"># replace the type and rely on Pydantic to generate the right schema</span>
            <span class="c1"># for `Sequence`</span>
            <span class="n">sequence_t_schema</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">generate_schema</span><span class="p">(</span><span class="n">Sequence</span><span class="p">[</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sequence_t_schema</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">generate_schema</span><span class="p">(</span><span class="n">Sequence</span><span class="p">)</span>

        <span class="n">non_instance_schema</span> <span class="o">=</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">general_after_validator_function</span><span class="p">(</span>
            <span class="k">lambda</span> <span class="n">v</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">MySequence</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">sequence_t_schema</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">core_schema</span><span class="o">.</span><span class="n">union_schema</span><span class="p">([</span><span class="n">instance_schema</span><span class="p">,</span> <span class="n">non_instance_schema</span><span class="p">])</span>


<span class="k">class</span> <span class="nc">M</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">model_config</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">validate_default</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">s1</span><span class="p">:</span> <span class="n">MySequence</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span>


<span class="n">m</span> <span class="o">=</span> <span class="n">M</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="c1">#&gt; s1=&lt;__main__.MySequence object at 0x0123456789ab&gt;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">s1</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
<span class="c1">#&gt; [3]</span>


<span class="k">class</span> <span class="nc">M</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">s1</span><span class="p">:</span> <span class="n">MySequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>


<span class="n">M</span><span class="p">(</span><span class="n">s1</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">M</span><span class="p">(</span><span class="n">s1</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">])</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">exc</span><span class="p">)</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    2 validation errors for M</span>
<span class="sd">    s1.is-instance[MySequence]</span>
<span class="sd">      Input should be an instance of MySequence [type=is_instance_of, input_value=[&#39;a&#39;], input_type=list]</span>
<span class="sd">    s1.function-after[&lt;lambda&gt;(), json-or-python[json=list[int],python=chain[is-instance[Sequence],function-wrap[sequence_validator()]]]].0</span>
<span class="sd">      Input should be a valid integer, unable to parse string as an integer [type=int_parsing, input_value=&#39;a&#39;, input_type=str]</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
</div>
</div>
</div>





                
  <script src="/flarelytics/client.js"></script>

              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.tabs.link", "content.code.annotate", "announce.dismiss", "navigation.tabs"], "search": "../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.b425cdc4.min.js"></script>
      
        
          <script src="../../../extra/redirects.js"></script>
        
      
    
  </body>
</html>